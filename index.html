<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Oswald&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> 
  <link rel="stylesheet" href="style.css" />
    <title>Work Day Scheduler</title>
  </head>

  
  <body>
    <header class="jumbotron">
      <h1 class="display-3">Work Day Scheduler</h1>
      <p class="lead">A simple calendar app for scheduling your work day</p>
      <p id="currentDay" class="lead"></p>
    </header>
    <div class="container">
    
      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="library/moment.min.js"></script>

    <script type="text/javascript">
      $(document).ready(function() {

//Listing today's date in header
  var nowHead = moment().format('MMMM Do, YYYY');
  $("#currentDay").text(nowHead);
    
//Creating calendar hours
var hourArr = [
//  {hour: "8 AM", military: 8, appt:""},
//  {hour: "9 AM", military: 9, appt:""},
//  {hour: "10 AM", military: 10, appt:""},
//  {hour: "11 AM", military: 11, appt:""},
//  {hour: "12 PM", military: 12, appt:""},
 {hour: "1 PM", military: 13, appt:""},
 {hour: "2 PM", military: 14, appt:""},
 {hour: "3 PM", military: 15, appt:""},
 {hour: "4 PM", military: 16, appt:""},
 {hour: "5 PM", military: 17, appt:""},
];  


// Create day view of calendar & for-loop to iterate through the time array.

function renderCal() {
  for (var i = 0; i < hourArr.length; i++) {  
//create div for each row
    var row = $("<div>");
    row.addClass("row row1 time-block");
    row.attr("time-hour", hourArr[i].hour)
    row.attr("id", hourArr[i].military);
    $(".container").append(row);

//create col 1 of 3 for hr
    var hourCol = $("<div>");
    hourCol.addClass("col col-2 justify-content-center hour row time-block ml-2 py-4");
    hourCol.text($(row).attr("time-hour"));
    $(row).append(hourCol);

//create col 2 of 3 for appt text
    var inputCol = $("<input>");
    inputCol.addClass("col col-8 input row time-block ml-3");
    inputCol.attr("input-key", hourArr[i].military);
    $(row).append(inputCol);

//create col 3 of 3 to hold saveBtn
    var saveCol = $("<div>");
    saveCol.addClass("col col-2 justify-content-center hour save row time-block ml-3");
    $(row).append(saveCol);

}}

renderCal();

function renderSaveBtn() {
//create saveBtn and classes, append to col
  var saveBtn = $("<button>");
    saveBtn.addClass("btn saveBtn btn-primary my-2 mx-2");
    saveBtn.text("Save");
    $(".save").append(saveBtn);
}

renderSaveBtn();

//Change <input> background color based on time/////////////////////////////////
var pastPresentFuture = function () {
  var currentTime = (moment().format('H'));

  for (var i = 0; i < hourArr.length; i++) {
  var militaryID = hourArr[i].military;
  
  //Ensuring both var are num
  militaryNum = parseInt(militaryID);
  timeNum = parseInt(currentTime);
  
  if (militaryNum < timeNum)  {
    $("#" + militaryID).children("input").addClass("past");
  }

  else if (militaryNum === timeNum ) {
    $("#" + militaryID).children("input").addClass("present");
  }

  else {
    $("#" + militaryID).children("input").addClass("future");
  }
};
  
  };

pastPresentFuture();

//input, saveBtn, localStorage //////////////////////////////////////////////////////

//store appt in LS
function storeAppt() {
  localStorage.setItem("myCal", JSON.stringify(myCal));
  console.log(myCal);
}

//from LS, display existing appts in <input> element for correct hr
function displayAppt() {
  hourArr.forEach(function (_thisHour) {
    $(`#${_thisHour.military}`).val(_thisHour.appt);
    console.log(_thisHour.appt);
  })
}

//check LS for appt first, then call display func
function initCal () {
  var storedAppt = JSON.parse(localStorage.getItem("myCal"));
  console.log(storedAppt);
  if (storedAppt !== null) {
    storedAppt = myCal;
  }
  displayAppt();
}

//saveBtn click event focusing on arr ID & input >>> append to hourArr
$(".saveBtn").on("click", function(event) {
  event.preventDefault();
  var apptHour = $(this).parent().parent().attr("id");
  console.log(apptHour);
  var apptInput = $(this).parent().siblings(".input").val();
  console.log(apptInput);
  
  hourArr.push(apptInput);
  // hourArr[apptHour].appt = $(this).parent().siblings("input").val();
 
    storeAppt();
  });

initCal();

  //////////////////////////////////////////
      });
    
</script>
  </body>
</html>